<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深度链接 | react navigation 5.x</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="试试">
    
    <link rel="preload" href="/reactnavigation/assets/css/0.styles.c084512d.css" as="style"><link rel="preload" href="/reactnavigation/assets/js/app.06c5ad1f.js" as="script"><link rel="preload" href="/reactnavigation/assets/js/2.1931d008.js" as="script"><link rel="preload" href="/reactnavigation/assets/js/64.f8334968.js" as="script"><link rel="prefetch" href="/reactnavigation/assets/js/10.55a310bb.js"><link rel="prefetch" href="/reactnavigation/assets/js/11.449a3349.js"><link rel="prefetch" href="/reactnavigation/assets/js/12.24a1d69e.js"><link rel="prefetch" href="/reactnavigation/assets/js/13.2965d5a8.js"><link rel="prefetch" href="/reactnavigation/assets/js/14.bfd37c2e.js"><link rel="prefetch" href="/reactnavigation/assets/js/15.68ab63f5.js"><link rel="prefetch" href="/reactnavigation/assets/js/16.0f72e130.js"><link rel="prefetch" href="/reactnavigation/assets/js/17.16594635.js"><link rel="prefetch" href="/reactnavigation/assets/js/18.dca2d259.js"><link rel="prefetch" href="/reactnavigation/assets/js/19.905865f4.js"><link rel="prefetch" href="/reactnavigation/assets/js/20.a342ac55.js"><link rel="prefetch" href="/reactnavigation/assets/js/21.eb7d985e.js"><link rel="prefetch" href="/reactnavigation/assets/js/22.b0a31519.js"><link rel="prefetch" href="/reactnavigation/assets/js/23.a857375c.js"><link rel="prefetch" href="/reactnavigation/assets/js/24.c422b0dd.js"><link rel="prefetch" href="/reactnavigation/assets/js/25.403cbf65.js"><link rel="prefetch" href="/reactnavigation/assets/js/26.d0c2f3cb.js"><link rel="prefetch" href="/reactnavigation/assets/js/27.de7e9625.js"><link rel="prefetch" href="/reactnavigation/assets/js/28.1f56c73d.js"><link rel="prefetch" href="/reactnavigation/assets/js/29.332a2e1d.js"><link rel="prefetch" href="/reactnavigation/assets/js/3.949cae60.js"><link rel="prefetch" href="/reactnavigation/assets/js/30.089ad555.js"><link rel="prefetch" href="/reactnavigation/assets/js/31.a9c7faf7.js"><link rel="prefetch" href="/reactnavigation/assets/js/32.be1711e2.js"><link rel="prefetch" href="/reactnavigation/assets/js/33.be19c74b.js"><link rel="prefetch" href="/reactnavigation/assets/js/34.d95a8dc0.js"><link rel="prefetch" href="/reactnavigation/assets/js/35.509ef6d2.js"><link rel="prefetch" href="/reactnavigation/assets/js/36.fdfcc2eb.js"><link rel="prefetch" href="/reactnavigation/assets/js/37.a21729c7.js"><link rel="prefetch" href="/reactnavigation/assets/js/38.82468988.js"><link rel="prefetch" href="/reactnavigation/assets/js/39.d0b2ed34.js"><link rel="prefetch" href="/reactnavigation/assets/js/4.67058592.js"><link rel="prefetch" href="/reactnavigation/assets/js/40.be1d77fd.js"><link rel="prefetch" href="/reactnavigation/assets/js/41.d6c76715.js"><link rel="prefetch" href="/reactnavigation/assets/js/42.400b9afe.js"><link rel="prefetch" href="/reactnavigation/assets/js/43.c787c282.js"><link rel="prefetch" href="/reactnavigation/assets/js/44.eed57f85.js"><link rel="prefetch" href="/reactnavigation/assets/js/45.86cb221d.js"><link rel="prefetch" href="/reactnavigation/assets/js/46.e238f601.js"><link rel="prefetch" href="/reactnavigation/assets/js/47.67b39a5f.js"><link rel="prefetch" href="/reactnavigation/assets/js/48.155a4369.js"><link rel="prefetch" href="/reactnavigation/assets/js/49.048d93be.js"><link rel="prefetch" href="/reactnavigation/assets/js/5.9d839219.js"><link rel="prefetch" href="/reactnavigation/assets/js/50.e5b2601f.js"><link rel="prefetch" href="/reactnavigation/assets/js/51.caba7691.js"><link rel="prefetch" href="/reactnavigation/assets/js/52.e9dbf56a.js"><link rel="prefetch" href="/reactnavigation/assets/js/53.0b284ab0.js"><link rel="prefetch" href="/reactnavigation/assets/js/54.3f286670.js"><link rel="prefetch" href="/reactnavigation/assets/js/55.2b5c3b06.js"><link rel="prefetch" href="/reactnavigation/assets/js/56.9d8ebc8c.js"><link rel="prefetch" href="/reactnavigation/assets/js/57.45da38ac.js"><link rel="prefetch" href="/reactnavigation/assets/js/58.4ff7663f.js"><link rel="prefetch" href="/reactnavigation/assets/js/59.da6ed64f.js"><link rel="prefetch" href="/reactnavigation/assets/js/6.2a89f9f8.js"><link rel="prefetch" href="/reactnavigation/assets/js/60.49c01b37.js"><link rel="prefetch" href="/reactnavigation/assets/js/61.0168ffd9.js"><link rel="prefetch" href="/reactnavigation/assets/js/62.7c9f892e.js"><link rel="prefetch" href="/reactnavigation/assets/js/63.2bb4f99e.js"><link rel="prefetch" href="/reactnavigation/assets/js/65.875ba9b5.js"><link rel="prefetch" href="/reactnavigation/assets/js/66.db24112d.js"><link rel="prefetch" href="/reactnavigation/assets/js/67.380ff58e.js"><link rel="prefetch" href="/reactnavigation/assets/js/68.50e28dee.js"><link rel="prefetch" href="/reactnavigation/assets/js/69.7f06bdfd.js"><link rel="prefetch" href="/reactnavigation/assets/js/7.3f495a3d.js"><link rel="prefetch" href="/reactnavigation/assets/js/70.9daf0f06.js"><link rel="prefetch" href="/reactnavigation/assets/js/71.80bbb0b5.js"><link rel="prefetch" href="/reactnavigation/assets/js/72.87246514.js"><link rel="prefetch" href="/reactnavigation/assets/js/73.6ea4022e.js"><link rel="prefetch" href="/reactnavigation/assets/js/74.f49f9057.js"><link rel="prefetch" href="/reactnavigation/assets/js/75.789d766a.js"><link rel="prefetch" href="/reactnavigation/assets/js/76.39b71742.js"><link rel="prefetch" href="/reactnavigation/assets/js/77.d37139df.js"><link rel="prefetch" href="/reactnavigation/assets/js/78.2feb8e59.js"><link rel="prefetch" href="/reactnavigation/assets/js/79.44352ab5.js"><link rel="prefetch" href="/reactnavigation/assets/js/8.f9689e81.js"><link rel="prefetch" href="/reactnavigation/assets/js/80.1cd42d15.js"><link rel="prefetch" href="/reactnavigation/assets/js/81.4c1b00d5.js"><link rel="prefetch" href="/reactnavigation/assets/js/82.034d86b2.js"><link rel="prefetch" href="/reactnavigation/assets/js/83.cc905ec6.js"><link rel="prefetch" href="/reactnavigation/assets/js/84.b164ea9e.js"><link rel="prefetch" href="/reactnavigation/assets/js/85.ed310ba9.js"><link rel="prefetch" href="/reactnavigation/assets/js/86.28034a60.js"><link rel="prefetch" href="/reactnavigation/assets/js/9.55c01fa0.js">
    <link rel="stylesheet" href="/reactnavigation/assets/css/0.styles.c084512d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/reactnavigation/" class="home-link router-link-active"><!----> <span class="site-name">react navigation 5.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://reactnavigation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://reactnavigation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reactnavigation/guide/Tab.html" class="sidebar-link">选项卡导航器</a></li><li><a href="/reactnavigation/guide/Drawer.html" class="sidebar-link">抽屉导航器</a></li><li><a href="/reactnavigation/guide/Auth.html" class="sidebar-link">身份验证流程</a></li><li><a href="/reactnavigation/guide/safe.html" class="sidebar-link">支持安全区域</a></li><li><a href="/reactnavigation/guide/hide.html" class="sidebar-link">在特定的屏幕隐藏标签栏</a></li><li><a href="/reactnavigation/guide/Diff.html" class="sidebar-link">不同路由的状态栏配置</a></li><li><a href="/reactnavigation/guide/option.html" class="sidebar-link">带有嵌套导航器的屏幕选项</a></li><li><a href="/reactnavigation/guide/androidback.html" class="sidebar-link">自定义Android返回按钮行为</a></li><li><a href="/reactnavigation/guide/Prevent.html" class="sidebar-link">阻止回退</a></li><li><a href="/reactnavigation/guide/change.html" class="sidebar-link">当焦点屏幕改变时调用一个函数</a></li><li><a href="/reactnavigation/guide/AccessProps.html" class="sidebar-link">从任何组件访问导航 prop</a></li><li><a href="/reactnavigation/guide/without.html" class="sidebar-link">在没有 navigation prop 的情况下进行导航</a></li><li><a href="/reactnavigation/guide/Deep.html" aria-current="page" class="active sidebar-link">深层链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#设置-expo-项目" class="sidebar-link">设置 Expo 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#uri-前缀" class="sidebar-link">URI 前缀</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#通用链接" class="sidebar-link">通用链接</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#多个子域" class="sidebar-link">多个子域</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#在-ios-上测试深层链接" class="sidebar-link">在 iOS 上测试深层链接</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#在-android-上测试深层链接" class="sidebar-link">在 Android 上测试深层链接</a></li></ul></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#设置裸-react-native-项目" class="sidebar-link">设置裸 React Native 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#ios" class="sidebar-link">iOS</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#android" class="sidebar-link">Android</a></li></ul></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#混合-react-本机和本机-ios-应用程序-仅适用于-react-native-的项目的跳过" class="sidebar-link">混合 React 本机和本机 iOS 应用程序（仅适用于 React-Native 的项目的跳过）</a></li><li class="sidebar-sub-header"><a href="/reactnavigation/guide/Deep.html#第三方整合" class="sidebar-link">第三方整合</a></li></ul></li><li><a href="/reactnavigation/guide/configlink.html" class="sidebar-link">配置链接</a></li><li><a href="/reactnavigation/guide/websupport.html" class="sidebar-link">Web support</a></li><li><a href="/reactnavigation/guide/serverrender.html" class="sidebar-link">服务端渲染</a></li><li><a href="/reactnavigation/guide/track.html" class="sidebar-link">用于分析的屏幕跟踪</a></li><li><a href="/reactnavigation/guide/theme.html" class="sidebar-link">主题</a></li><li><a href="/reactnavigation/guide/persistence.html" class="sidebar-link">状态持续性</a></li><li><a href="/reactnavigation/guide/jest.html" class="sidebar-link">使用 Jest 测试</a></li><li><a href="/reactnavigation/guide/ts.html" class="sidebar-link">使用TypeScript进行类型检查</a></li><li><a href="/reactnavigation/guide/redux.html" class="sidebar-link">Redux 集成</a></li><li><a href="/reactnavigation/guide/local.html" class="sidebar-link">本地化</a></li><li><a href="/reactnavigation/guide/Optimize.html" class="sidebar-link">优化内存使用和性能</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API 参考</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深度链接"><a href="#深度链接" class="header-anchor">#</a> 深度链接</h1> <p>在本指南中，我们将配置我们的应用程序以处理各种平台上的深度链接。要处理传入链接，我们需要处理以下两种情况：</p> <ol><li>如果该应用先前未打开，则需要基于链接设置初始状态</li> <li>如果应用程序已经打开，我们需要更新状态以显示传入的链接</li></ol> <p>React Native 提供了一个链接来通知传入的链接。 React Navigation 可以与链接模块集成以自动处理深层链接。请参阅配置链接以查看有关如何在 React Navigation 中配置链接的更多详细信息。</p> <p>下面，我们将详细介绍每个平台的必需配置，以便进行深层链接集成。</p> <h2 id="设置-expo-项目"><a href="#设置-expo-项目" class="header-anchor">#</a> 设置 Expo 项目</h2> <p>首先，您将要为您的应用程序指定 <code>URL scheme</code>。这与 URL 中<code>://</code>之前的字符串相对应，因此，如果您的方案是 <code>mychat</code>，则指向您应用程序的链接将是 <code>mychat://</code>。该方案仅适用于独立应用程序，您需要重新构建独立应用程序才能使更改生效。在 Expo client 应用程序中，您可以使用 <code>exp://ADDRESS:PORT</code> 进行深层链接，其中 <code>ADDRESS</code> 通常为 <code>127.0.0.1</code>，而 <code>PORT</code> 通常为 <code>19000</code>-运行 <code>expo start</code> 时会打印 URL。如果要使用自定义方案进行测试，则需要运行 <code>expo build:ios -t simulator</code> 或 <code>expo build:android</code> 并将生成的二进制文件安装在模拟器中。您可以通过在<code>app.json</code> 中的 scheme 下添加一个字符串来注册一个 scheme：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;expo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;scheme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mychat&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="uri-前缀"><a href="#uri-前缀" class="header-anchor">#</a> URI 前缀</h3> <p>接下来，让我们配置导航容器，以从应用程序的传入 URI 中提取路径。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Install this package with `expo install expo-linking`</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Linking <span class="token keyword">from</span> <span class="token string">&quot;expo-linking&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Linking.createURL is available as of expo@40.0.1 and expo-linking@2.0.1. If</span>
<span class="token comment">// you are using older versions, you can upgrade or use Linking.makeUrl instead,</span>
<span class="token comment">// but note that your deep links in standalone apps will be in the format</span>
<span class="token comment">// scheme:/// rather than scheme:// if you use makeUrl.</span>
<span class="token keyword">const</span> prefix <span class="token operator">=</span> Linking<span class="token punctuation">.</span><span class="token function">createURL</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> linking <span class="token operator">=</span> <span class="token punctuation">{</span>
    prefixes<span class="token operator">:</span> <span class="token punctuation">[</span>prefix<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>NavigationContainer linking<span class="token operator">=</span><span class="token punctuation">{</span>linking<span class="token punctuation">}</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Text<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* content */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>NavigationContainer<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 <code>Linking.createURL</code> 的必要原因是该方案会有所不同，具体取决于您是在客户端应用程序中还是在独立应用程序中。</p> <h3 id="通用链接"><a href="#通用链接" class="header-anchor">#</a> 通用链接</h3> <p>如果使用通用链接，则需要将域添加到前缀中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> linking <span class="token operator">=</span> <span class="token punctuation">{</span>
    prefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://app.example.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>NavigationContainer linking<span class="token operator">=</span><span class="token punctuation">{</span>linking<span class="token punctuation">}</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Text<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* content */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>NavigationContainer<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注意：如果使用的是 Expo SDK 版本 37 或更低版本，则需要同时使用 <code>https</code> 和 <code>exps</code> 方案添加域，以解决 Expo 中的此错误。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">const</span> linking <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token operator">-</span>    prefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'https://app.example.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>    prefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'https://app.example.com'</span><span class="token punctuation">,</span> <span class="token string">'exps://app.example.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="多个子域"><a href="#多个子域" class="header-anchor">#</a> 多个子域</h3> <p>要匹配关联域的所有子域，您可以通过特定域前缀指定通配符<code>*.</code>。 请注意，<code>*.example.com</code> 的条目与星号后面的句号不匹配 <code>example.com</code>。 要同时为 <code>*.example.com</code> 和 <code>example.com</code> 启用匹配，您需要为每个提供单独的前缀条目。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> linking <span class="token operator">=</span> <span class="token punctuation">{</span>
  prefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://*.example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://example.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在-ios-上测试深层链接"><a href="#在-ios-上测试深层链接" class="header-anchor">#</a> 在 iOS 上测试深层链接</h3> <p>要在 Expo 客户端应用程序中的模拟器上测试 URI，请运行以下命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx uri-scheme <span class="token function">open</span> <span class="token punctuation">[</span> put your uri prefix <span class="token keyword">in</span> here<span class="token punctuation">]</span> --ios

<span class="token comment"># for example</span>

npx uri-scheme <span class="token function">open</span> exp://127.0.0.1:19000/--/chat/jan --ios
</code></pre></div><p>或直接使用 xcrun：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>xcrun simctl openurl booted <span class="token punctuation">[</span> put your URI prefix <span class="token keyword">in</span> here <span class="token punctuation">]</span>

<span class="token comment"># for example</span>

xcrun simctl openurl booted exp://127.0.0.1:19000/--/chat/jane
</code></pre></div><h3 id="在-android-上测试深层链接"><a href="#在-android-上测试深层链接" class="header-anchor">#</a> 在 Android 上测试深层链接</h3> <p>要在 Android 上的 Expo 客户端应用程序中测试意图处理，请运行以下命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx uri-scheme <span class="token function">open</span> <span class="token string">&quot;[ put your URI prefix in here ]&quot;</span> --/chat/jan --android

<span class="token comment"># for example</span>

npx uri-scheme <span class="token function">open</span> exp://127.0.0.1:19000/--/chat/jan --android
</code></pre></div><p>或直接使用 adb：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>adb shell am start -W -a android.intent.action.VIEW -d <span class="token string">&quot;[ put your URI prefix in here ]&quot;</span> host.exp.exponent

<span class="token comment"># for example</span>

adb shell am start -W -a android.intent.action.VIEW -d <span class="token string">&quot;exp://127.0.0.1:19000/--/chat/jane&quot;</span> host.exp.exponent
</code></pre></div><p>如果要在独立应用程序上进行测试，请将 <code>host.exp.exponent</code> 更改为您的应用程序包名称。</p> <p>阅读 Expo 链接指南，以获取有关如何在使用 Expo 构建的项目中配置链接的更多信息。</p> <h2 id="设置裸-react-native-项目"><a href="#设置裸-react-native-项目" class="header-anchor">#</a> 设置裸 React Native 项目</h2> <h3 id="ios"><a href="#ios" class="header-anchor">#</a> iOS</h3> <p>让我们将本机 iOS 应用程序配置为基于<code>mychat://</code> URI 方案打开。</p> <p>您需要按照此处介绍的步骤将 <code>RCTLinking</code> 链接到您的项目。 为了能够收听传入的应用程序链接，您需要将以下行添加到 <code>SimpleApp/ios/SimpleApp/AppDelegate.m</code>。</p> <p>如果您的目标是 iOS 9.x 或更高版本：</p> <div class="language-oc extra-class"><pre class="language-text"><code>// Add the header at the top of the file:
#import &lt;React/RCTLinkingManager.h&gt;

// Add this above `@end`:
- (BOOL)application:(UIApplication *)application
   openURL:(NSURL *)url
   options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey,id&gt; *)options
{
  return [RCTLinkingManager application:application openURL:url options:options];
}
</code></pre></div><p>如果您要定位的是 iOS 8.x 或更旧版本，则可以改用以下代码：</p> <div class="language-oc extra-class"><pre class="language-text"><code>// Add the header at the top of the file:
#import &lt;React/RCTLinkingManager.h&gt;

// Add this above `@end`:
- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url
  sourceApplication:(NSString *)sourceApplication annotation:(id)annotation
{
  return [RCTLinkingManager application:application openURL:url
                      sourceApplication:sourceApplication annotation:annotation];
}
</code></pre></div><p>如果您的应用程序使用通用链接，则还需要添加以下代码：</p> <div class="language-oc extra-class"><pre class="language-text"><code>// Add this above `@end`:
- (BOOL)application:(UIApplication *)application continueUserActivity:(nonnull NSUserActivity *)userActivity
 restorationHandler:(nonnull void (^)(NSArray&lt;id&lt;UIUserActivityRestoring&gt;&gt; * _Nullable))restorationHandler
{
 return [RCTLinkingManager application:application
                  continueUserActivity:userActivity
                    restorationHandler:restorationHandler];
}
</code></pre></div><p>现在，您需要将该方案添加到您的项目配置中。</p> <p>最简单的方法是使用 <code>uri-scheme</code> 软件包：<code>npx uri-scheme add mychat --ios</code>。</p> <p>如果要手动执行此操作，请在 Xcode 中的 <code>SimpleApp/ios/SimpleApp.xcodeproj</code> 中打开项目。 在边栏中选择项目，然后导航到信息选项卡。 向下滚动到“URL Types”并添加一个。 在新的 URL 类型中，将标识符和 URL 方案设置为所需的 URL 方案。</p> <img src="/reactnavigation/images/e8b3.png" alt="fsdfsd"> <p>现在你可以在 Xcode 中按 play 键，或者在命令行中重新构建:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx react-native run-ios
</code></pre></div><p>要在模拟器上测试 URI，运行以下命令:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx uri-scheme <span class="token function">open</span> mychat://chat/jane --ios
</code></pre></div><p>或者直接使用 <code>xrun</code>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>xcrun simctl openurl booted mychat://chat/jane
</code></pre></div><p>要在真正的设备上测试 URI，请打开 Safari 并输入 <code>mychat://chat/jane</code>。</p> <h3 id="android"><a href="#android" class="header-anchor">#</a> Android</h3> <p>要在 Android 中配置外部链接，您可以在清单中创建新的意图。</p> <p>最简单的方法是使用 <code>uri-scheme</code> 软件包：<code>npx uri-scheme add mychat --android</code>。</p> <p>如果要手动添加，请打开 <code>SimpleApp/android/app/src/main/AndroidManifest.xml</code>，然后进行以下调整：</p> <p>将 <code>MainActivity</code> 的 <code>launchMode</code> 设置为 <code>singleTask</code> 以便接收现有 <code>MainActivity</code> 的意图（这是所有新项目的默认设置，因此您可能不需要实际进行任何更改！）。 如果要使用已注册的深层链接进行导航，则很有用-<a href="http://developer.android.com/training/app-indexing/deep-linking.html#adding-filters" target="_blank" rel="noopener noreferrer">详细信息<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
使用 <code>VIEW</code> 类型的动作在 <code>MainActivity</code> 条目内添加新的 <code>intent-filter</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleTask<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.MAIN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.LAUNCHER<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.VIEW<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.BROWSABLE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mychat<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在，重新安装应用程序:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>react-native run-android
</code></pre></div><p>要测试 Android 中的意图处理，运行以下命令:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx uri-scheme <span class="token function">open</span> mychat://chat/jane --android
</code></pre></div><p>或者直接使用 adb:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>adb shell am start -W -a android.intent.action.VIEW -d <span class="token string">&quot;mychat://chat/jane&quot;</span> com.simpleapp
</code></pre></div><h2 id="混合-react-本机和本机-ios-应用程序-仅适用于-react-native-的项目的跳过"><a href="#混合-react-本机和本机-ios-应用程序-仅适用于-react-native-的项目的跳过" class="header-anchor">#</a> 混合 React 本机和本机 iOS 应用程序（仅适用于 React-Native 的项目的跳过）</h2> <p>如果您在混合应用程序（具有 Swift/ObjC 和 React Native 部件的 iOS 应用程序）中使用 React Navigation，则可能会丢失 Podfile 中的 <code>RCTLinkingIOS</code> 子规范，该子规范默认情况下安装在新的 RN 项目中。 要添加此内容，请确保您的 Podfile 如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code> pod 'React', :path =&gt; '../node_modules/react-native', :subspecs =&gt; [
    . . . // other subspecs
    'RCTLinkingIOS',
    . . .
  ]
</code></pre></div><h2 id="第三方整合"><a href="#第三方整合" class="header-anchor">#</a> 第三方整合</h2> <p>React Native 的 <code>Linking</code> 并不是处理深度链接的唯一方法。 您可能还希望集成其他服务，例如 Branch，它们提供了自己的 API 来接收传入链接的通知，或者您可能还希望使用 Firebase 处理来自推送通知的链接。</p> <p>为此，您需要覆盖 React Navigation 订阅传入链接的方式。 为此，您可以提供自己的 <code>getInitialURL</code> 并 <code>subscribe</code> 函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> linking <span class="token operator">=</span> <span class="token punctuation">{</span>
  prefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'myapp://'</span><span class="token punctuation">,</span> <span class="token string">'https://myapp.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token comment">// Custom function to get the URL which was used to open the app</span>
  <span class="token keyword">async</span> <span class="token function">getInitialURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// First, you may want to do the default deep link handling</span>
    <span class="token comment">// Check if app was opened from a deep link</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> Linking<span class="token punctuation">.</span><span class="token function">getInitialURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Next, you would need to get the initial URL from your third-party integration</span>
    <span class="token comment">// It depends on the third-party SDK you use</span>
    <span class="token comment">// For example, to get to get the initial URL for branch.io:</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> branch<span class="token punctuation">.</span><span class="token function">getFirstReferringParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> params<span class="token operator">?.</span>$canonical_url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// Custom function to subscribe to incoming links</span>
  <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// First, you may want to do the default deep link handling</span>
    <span class="token keyword">const</span> <span class="token function-variable function">onReceiveURL</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> url<span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">listener</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Listen to incoming links from deep linking</span>
    Linking<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> onReceiveURL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Next, you would need to subscribe to incoming links from your third-party integration</span>
    <span class="token comment">// For example, to get to subscribe to incoming links from branch.io:</span>
    branch<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error<span class="token punctuation">,</span> params<span class="token punctuation">,</span> uri <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error from Branch: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token string">'+non_branch_link'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nonBranchUrl <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'+non_branch_link'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// Route non-Branch URL if appropriate.</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>params<span class="token punctuation">[</span><span class="token string">'+clicked_branch_link'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Indicates initialization success and some other conditions.</span>
        <span class="token comment">// No link was opened.</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// A Branch link was opened</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> params<span class="token punctuation">.</span>$canonical_url<span class="token punctuation">;</span>

      <span class="token function">listener</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Clean up the event listeners</span>
      Linking<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> onReceiveURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
      branch<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  config<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Deep link configuration</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>与上面的示例类似，您可以集成任何提供获取初始 URL 和使用 <code>getInitialURL</code> 和 <code>subscribe</code> 选项订阅新传入 URL 的方法的 API。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/reactnavigation/guide/without.html" class="prev">
        在没有 navigation prop 的情况下进行导航
      </a></span> <span class="next"><a href="/reactnavigation/guide/configlink.html">
        配置链接
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/reactnavigation/assets/js/app.06c5ad1f.js" defer></script><script src="/reactnavigation/assets/js/2.1931d008.js" defer></script><script src="/reactnavigation/assets/js/64.f8334968.js" defer></script>
  </body>
</html>
